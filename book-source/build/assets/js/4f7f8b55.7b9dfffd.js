"use strict";(globalThis.webpackChunkai_book=globalThis.webpackChunkai_book||[]).push([[30],{8453:(e,n,o)=>{o.d(n,{R:()=>t,x:()=>l});var r=o(6540);const s={},i=r.createContext(s);function t(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),r.createElement(i.Provider,{value:n},e.children)}},8656:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"Gazebo-Simulation/multi-robot-capstone","title":"Lesson 8: Multi-Robot Capstone Project","description":"Coordinate multiple robots with collision avoidance and autonomous navigation","source":"@site/docs/03-Gazebo-Simulation/08-multi-robot-capstone.md","sourceDirName":"03-Gazebo-Simulation","slug":"/Gazebo-Simulation/multi-robot-capstone","permalink":"/docs/Gazebo-Simulation/multi-robot-capstone","draft":false,"unlisted":false,"editUrl":"https://github.com/your-org/ai-book/tree/main/docs/03-Gazebo-Simulation/08-multi-robot-capstone.md","tags":[],"version":"current","sidebarPosition":9,"frontMatter":{"sidebar_position":9,"title":"Lesson 8: Multi-Robot Capstone Project","description":"Coordinate multiple robots with collision avoidance and autonomous navigation"},"sidebar":"tutorialSidebar","previous":{"title":"Lesson 7: Gazebo-ROS 2 Integration","permalink":"/docs/Gazebo-Simulation/gazebo-ros2-integration"},"next":{"title":"Chapter 3: Autonomous Navigation","permalink":"/docs/Autonomous-Navigation/intro"}}');var s=o(4848),i=o(8453);const t={sidebar_position:9,title:"Lesson 8: Multi-Robot Capstone Project",description:"Coordinate multiple robots with collision avoidance and autonomous navigation"},l="Lesson 8: Multi-Robot Capstone Project (120 minutes)",a={},d=[{value:"Learning Outcomes",id:"learning-outcomes",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Core Concepts (9 Total)",id:"core-concepts-9-total",level:2},{value:"1. Robot Namespacing",id:"1-robot-namespacing",level:3},{value:"2. Multi-Robot Spawning",id:"2-multi-robot-spawning",level:3},{value:"3. Odometry (Robot Pose)",id:"3-odometry-robot-pose",level:3},{value:"4. Collision Avoidance (Distance-Based)",id:"4-collision-avoidance-distance-based",level:3},{value:"5. Leader-Follower Pattern",id:"5-leader-follower-pattern",level:3},{value:"6. Fleet Coordination",id:"6-fleet-coordination",level:3},{value:"7. Multi-Robot Debugging",id:"7-multi-robot-debugging",level:3},{value:"8. Launch File Orchestration",id:"8-launch-file-orchestration",level:3},{value:"9. Multi-Robot Safety",id:"9-multi-robot-safety",level:3},{value:"Layer 1: Manual Exercise - Design Multi-Robot System",id:"layer-1-manual-exercise---design-multi-robot-system",level:2},{value:"Exercise Steps:",id:"exercise-steps",level:3},{value:"Code Examples: Multi-Robot Coordination",id:"code-examples-multi-robot-coordination",level:2},{value:"Collision Avoidance Node",id:"collision-avoidance-node",level:3},{value:"Leader-Follower Node",id:"leader-follower-node",level:3},{value:"Status Reporter Node",id:"status-reporter-node",level:3},{value:"Layer 2: AI Collaboration Notes",id:"layer-2-ai-collaboration-notes",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Problem: Robots spawn on top of each other",id:"problem-robots-spawn-on-top-of-each-other",level:3},{value:"Problem: Multi-robot topics conflict (both publish to <code>/cmd_vel</code>)",id:"problem-multi-robot-topics-conflict-both-publish-to-cmd_vel",level:3},{value:"Problem: TF tree shows only one robot&#39;s frames",id:"problem-tf-tree-shows-only-one-robots-frames",level:3},{value:"Problem: Collision avoidance activates when robots far apart",id:"problem-collision-avoidance-activates-when-robots-far-apart",level:3},{value:"Problem: Follower never catches up to leader",id:"problem-follower-never-catches-up-to-leader",level:3},{value:"Self-Assessment Checklist",id:"self-assessment-checklist",level:2},{value:"Capstone Challenge: Full Autonomous System",id:"capstone-challenge-full-autonomous-system",level:2},{value:"Key Takeaways",id:"key-takeaways",level:2},{value:"Chapter 2 Complete!",id:"chapter-2-complete",level:2},{value:"Chapter 2 Summary",id:"chapter-2-summary",level:2}];function c(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"lesson-8-multi-robot-capstone-project-120-minutes",children:"Lesson 8: Multi-Robot Capstone Project (120 minutes)"})}),"\n",(0,s.jsx)(n.h2,{id:"learning-outcomes",children:"Learning Outcomes"}),"\n",(0,s.jsx)(n.p,{children:"By the end of this lesson, you will:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Design multi-robot systems with unique namespaces"}),"\n",(0,s.jsx)(n.li,{children:"Spawn 2+ robots in the same Gazebo world"}),"\n",(0,s.jsx)(n.li,{children:"Implement distance-based collision avoidance"}),"\n",(0,s.jsx)(n.li,{children:"Create leader-follower coordination patterns"}),"\n",(0,s.jsx)(n.li,{children:"Debug multi-robot systems using RViz and ROS 2 tools"}),"\n",(0,s.jsx)(n.li,{children:"Demonstrate a complete autonomous system (sense \u2192 process \u2192 control)"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Lessons 1-7 completed (all prior content)"}),"\n",(0,s.jsx)(n.li,{children:"Understanding of ROS 2 topics, nodes, and basic kinematics"}),"\n",(0,s.jsx)(n.li,{children:"Familiarity with Python 3.10+"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"core-concepts-9-total",children:"Core Concepts (9 Total)"}),"\n",(0,s.jsx)(n.h3,{id:"1-robot-namespacing",children:"1. Robot Namespacing"}),"\n",(0,s.jsx)(n.p,{children:"Separate topics for each robot to avoid collisions:"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Without namespacing"})," (conflict):"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Robot1: /cmd_vel, /odom, /joint_states\r\nRobot2: /cmd_vel, /odom, /joint_states  # Same topics!\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"With namespacing"})," (isolated):"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Robot1: /robot1/cmd_vel, /robot1/odom, /robot1/joint_states\r\nRobot2: /robot2/cmd_vel, /robot2/odom, /robot2/joint_states\n"})}),"\n",(0,s.jsx)(n.p,{children:"Implement via ROS 2 launch file remapping."}),"\n",(0,s.jsx)(n.h3,{id:"2-multi-robot-spawning",children:"2. Multi-Robot Spawning"}),"\n",(0,s.jsx)(n.p,{children:"Launch file spawns multiple robots at different positions:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"# Spawn robot1 at (0, 0)\r\nspawn_robot1 = ExecuteProcess(\r\n    cmd=['ros2', 'service', 'call', '/spawn_entity', 'gazebo_msgs/SpawnEntity',\r\n         '{name: \"robot1\", xml: \"<robot>...\", initial_pose: {position: {x: 0, y: 0}}}'])\r\n\r\n# Spawn robot2 at (2, 0)\r\nspawn_robot2 = ExecuteProcess(\r\n    cmd=['ros2', 'service', 'call', '/spawn_entity', 'gazebo_msgs/SpawnEntity',\r\n         '{name: \"robot2\", xml: \"<robot>...\", initial_pose: {position: {x: 2, y: 0}}}'])\n"})}),"\n",(0,s.jsx)(n.h3,{id:"3-odometry-robot-pose",children:"3. Odometry (Robot Pose)"}),"\n",(0,s.jsx)(n.p,{children:"ROS 2 odometry message provides robot position/velocity:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'nav_msgs.msg.Odometry:\r\n  header.frame_id: "odom"\r\n  child_frame_id: "base_link"\r\n  pose.pose.position: (x, y, z)  # Robot position\r\n  twist.twist.linear: (vx, vy, vz)  # Robot velocity\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Extract position: ",(0,s.jsx)(n.code,{children:"msg.pose.pose.position.x"}),", ",(0,s.jsx)(n.code,{children:".y"})]}),"\n",(0,s.jsx)(n.h3,{id:"4-collision-avoidance-distance-based",children:"4. Collision Avoidance (Distance-Based)"}),"\n",(0,s.jsx)(n.p,{children:"Simple but effective:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"# Distance between two robots\r\ndistance = sqrt((x1 - x2)\xb2 + (y1 - y2)\xb2)\r\n\r\nif distance < threshold:\r\n    # Too close, stop or back away\r\n    publish(Twist(linear=Vector3(x=0)))\n"})}),"\n",(0,s.jsx)(n.h3,{id:"5-leader-follower-pattern",children:"5. Leader-Follower Pattern"}),"\n",(0,s.jsx)(n.p,{children:"Follower tracks leader position:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"# Leader publishes position on /robot1/odom\r\n# Follower subscribes and computes desired position\r\n\r\nerror_x = leader_x - follower_x\r\nerror_y = leader_y - follower_y\r\n\r\n# Move toward leader\r\ntwist.linear.x = Kp_linear * sqrt(error_x\xb2 + error_y\xb2)\r\ntwist.angular.z = Kp_angular * atan2(error_y, error_x)\n"})}),"\n",(0,s.jsx)(n.h3,{id:"6-fleet-coordination",children:"6. Fleet Coordination"}),"\n",(0,s.jsx)(n.p,{children:"Centralized coordination node monitors all robots:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Gathers odometry from all robots"}),"\n",(0,s.jsx)(n.li,{children:"Implements global constraints (collision avoidance, formation)"}),"\n",(0,s.jsx)(n.li,{children:"Sends commands to individual robots"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"7-multi-robot-debugging",children:"7. Multi-Robot Debugging"}),"\n",(0,s.jsx)(n.p,{children:"RViz shows multiple robots:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Add ",(0,s.jsx)(n.strong,{children:"RobotModel"})," display for each ",(0,s.jsx)(n.code,{children:"/robot_description"})," topic"]}),"\n",(0,s.jsxs)(n.li,{children:["Add ",(0,s.jsx)(n.strong,{children:"Odometry"})," display for each ",(0,s.jsx)(n.code,{children:"/robot/odom"})]}),"\n",(0,s.jsxs)(n.li,{children:["Use ",(0,s.jsx)(n.strong,{children:"TF Tree"})," to verify frame relationships"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"8-launch-file-orchestration",children:"8. Launch File Orchestration"}),"\n",(0,s.jsx)(n.p,{children:"Python-based launch file coordinates startup:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from launch import LaunchDescription\r\nfrom launch.actions import ExecuteProcess, IncludeLaunchDescription\r\nfrom launch_ros.actions import Node\r\n\r\ndef generate_launch_description():\r\n    return LaunchDescription([\r\n        # Start Gazebo\r\n        ExecuteProcess(cmd=['gazebo', 'multi_robot_world.world']),\r\n\r\n        # Spawn robots\r\n        ExecuteProcess(cmd=[...spawn robot1...]),\r\n        ExecuteProcess(cmd=[...spawn robot2...]),\r\n\r\n        # Start coordination nodes\r\n        Node(package='...', executable='collision_avoidance_node', namespace='robot1'),\r\n        Node(package='...', executable='collision_avoidance_node', namespace='robot2'),\r\n    ])\n"})}),"\n",(0,s.jsx)(n.h3,{id:"9-multi-robot-safety",children:"9. Multi-Robot Safety"}),"\n",(0,s.jsx)(n.p,{children:"Critical for avoiding collisions:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Minimum separation distance"})," (e.g., 0.3m)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Velocity limits"})," per robot (conservative acceleration)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Emergency stop"}),": Publish stop commands if collision imminent"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Safe startup"}),": Verify robots don't spawn overlapping"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"layer-1-manual-exercise---design-multi-robot-system",children:"Layer 1: Manual Exercise - Design Multi-Robot System"}),"\n",(0,s.jsx)(n.h3,{id:"exercise-steps",children:"Exercise Steps:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Design layout"})," (paper sketch):"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Robot1 at origin (0, 0)"}),"\n",(0,s.jsx)(n.li,{children:"Robot2 at (2, 0) - 2 meters away"}),"\n",(0,s.jsx)(n.li,{children:"Both identical differential drive robots"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Create launch file"})," to spawn both robots"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Verify in RViz"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Both robots appear at correct positions"}),"\n",(0,s.jsx)(n.li,{children:"Each has unique TF frames (robot1/base_link, robot2/base_link)"}),"\n",(0,s.jsx)(n.li,{children:"Topics are properly namespaced"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Test collision avoidance"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Move Robot1 toward Robot2"}),"\n",(0,s.jsx)(n.li,{children:"Observe Robot1 stops before collision"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"code-examples-multi-robot-coordination",children:"Code Examples: Multi-Robot Coordination"}),"\n",(0,s.jsx)(n.h3,{id:"collision-avoidance-node",children:"Collision Avoidance Node"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"File"}),": ",(0,s.jsx)(n.code,{children:"examples/chapter-2-gazebo/lesson-08/collision_avoidance_node.py"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"#!/usr/bin/env python3\r\n\"\"\"\r\nCollision avoidance for multi-robot system\r\nSimulation environment: Gazebo 11+\r\n\"\"\"\r\n\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom nav_msgs.msg import Odometry\r\nfrom geometry_msgs.msg import Twist\r\nimport math\r\n\r\nclass CollisionAvoidanceNode(Node):\r\n    def __init__(self):\r\n        super().__init__('collision_avoidance')\r\n\r\n        # Configuration\r\n        self.this_robot_ns = self.get_namespace()  # e.g., /robot1\r\n        self.other_robot_ns = '/robot2' if self.this_robot_ns == '/robot1' else '/robot1'\r\n        self.min_safe_distance = 0.5  # meters\r\n        self.desired_velocity = 0.3   # m/s\r\n\r\n        # State\r\n        self.this_position = None\r\n        self.other_position = None\r\n\r\n        # Subscribe to odometry\r\n        self.this_odom_sub = self.create_subscription(\r\n            Odometry,\r\n            f'{self.this_robot_ns}/odom',\r\n            self.this_odom_callback,\r\n            10)\r\n\r\n        self.other_odom_sub = self.create_subscription(\r\n            Odometry,\r\n            f'{self.other_robot_ns}/odom',\r\n            self.other_odom_callback,\r\n            10)\r\n\r\n        # Publisher for velocity commands\r\n        self.vel_pub = self.create_publisher(\r\n            Twist,\r\n            f'{self.this_robot_ns}/cmd_vel',\r\n            10)\r\n\r\n        self.get_logger().info(\r\n            f'Collision avoidance initialized. '\r\n            f'This robot: {self.this_robot_ns}, Other: {self.other_robot_ns}')\r\n\r\n    def this_odom_callback(self, msg):\r\n        \"\"\"Update this robot's position\"\"\"\r\n        self.this_position = (\r\n            msg.pose.pose.position.x,\r\n            msg.pose.pose.position.y)\r\n\r\n        self.update_control()\r\n\r\n    def other_odom_callback(self, msg):\r\n        \"\"\"Update other robot's position\"\"\"\r\n        self.other_position = (\r\n            msg.pose.pose.position.x,\r\n            msg.pose.pose.position.y)\r\n\r\n    def update_control(self):\r\n        \"\"\"Compute and publish velocity command\"\"\"\r\n        if self.this_position is None or self.other_position is None:\r\n            return\r\n\r\n        try:\r\n            # Calculate distance to other robot\r\n            dx = self.other_position[0] - self.this_position[0]\r\n            dy = self.other_position[1] - self.this_position[1]\r\n            distance = math.sqrt(dx**2 + dy**2)\r\n\r\n            self.get_logger().debug(f'Distance to other robot: {distance:.2f}m')\r\n\r\n            # Create velocity command\r\n            twist = Twist()\r\n\r\n            if distance < self.min_safe_distance:\r\n                # Too close - stop\r\n                self.get_logger().warn(\r\n                    f'Collision warning! Distance: {distance:.2f}m < {self.min_safe_distance}m')\r\n                twist.linear.x = 0.0\r\n                twist.angular.z = 0.0\r\n            else:\r\n                # Safe distance - move forward\r\n                twist.linear.x = self.desired_velocity\r\n                twist.angular.z = 0.0\r\n\r\n            # Publish command\r\n            self.vel_pub.publish(twist)\r\n\r\n        except Exception as e:\r\n            self.get_logger().error(f'Control error: {e}')\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = CollisionAvoidanceNode()\r\n    try:\r\n        rclpy.spin(node)\r\n    except KeyboardInterrupt:\r\n        pass\r\n    finally:\r\n        node.destroy_node()\r\n        rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,s.jsx)(n.h3,{id:"leader-follower-node",children:"Leader-Follower Node"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"File"}),": ",(0,s.jsx)(n.code,{children:"examples/chapter-2-gazebo/lesson-08/leader_follower_node.py"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"#!/usr/bin/env python3\r\n\"\"\"\r\nLeader-follower control for multi-robot coordination\r\nSimulation environment: Gazebo 11+\r\n\"\"\"\r\n\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom nav_msgs.msg import Odometry\r\nfrom geometry_msgs.msg import Twist\r\nimport math\r\n\r\nclass LeaderFollowerNode(Node):\r\n    def __init__(self):\r\n        super().__init__('leader_follower')\r\n\r\n        # Configuration\r\n        self.this_robot_ns = self.get_namespace()\r\n        self.leader_ns = '/robot1'\r\n        self.follower_ns = '/robot2'\r\n\r\n        # Control gains\r\n        self.Kp_linear = 0.5   # Linear speed gain\r\n        self.Kp_angular = 1.0  # Angular speed gain\r\n        self.desired_distance = 0.3  # meters (keep this far behind leader)\r\n\r\n        # State\r\n        self.leader_position = None\r\n        self.leader_angle = None\r\n        self.follower_position = None\r\n\r\n        # Check if this robot is the follower\r\n        self.is_follower = (self.this_robot_ns == self.follower_ns)\r\n\r\n        if not self.is_follower:\r\n            self.get_logger().info('This robot is the leader (no action)')\r\n            return\r\n\r\n        # Subscribe to leader odometry\r\n        self.leader_odom_sub = self.create_subscription(\r\n            Odometry,\r\n            f'{self.leader_ns}/odom',\r\n            self.leader_odom_callback,\r\n            10)\r\n\r\n        # Subscribe to follower odometry\r\n        self.follower_odom_sub = self.create_subscription(\r\n            Odometry,\r\n            f'{self.follower_ns}/odom',\r\n            self.follower_odom_callback,\r\n            10)\r\n\r\n        # Publisher for follower commands\r\n        self.vel_pub = self.create_publisher(\r\n            Twist,\r\n            f'{self.follower_ns}/cmd_vel',\r\n            10)\r\n\r\n        self.get_logger().info('Leader-follower control initialized (follower role)')\r\n\r\n    def leader_odom_callback(self, msg):\r\n        \"\"\"Update leader position\"\"\"\r\n        if not self.is_follower:\r\n            return\r\n\r\n        self.leader_position = (\r\n            msg.pose.pose.position.x,\r\n            msg.pose.pose.position.y)\r\n\r\n        # Extract leader angle from quaternion (yaw)\r\n        from tf_transformations import euler_from_quaternion\r\n        quat = [\r\n            msg.pose.pose.orientation.x,\r\n            msg.pose.pose.orientation.y,\r\n            msg.pose.pose.orientation.z,\r\n            msg.pose.pose.orientation.w]\r\n        _, _, self.leader_angle = euler_from_quaternion(quat)\r\n\r\n        self.update_control()\r\n\r\n    def follower_odom_callback(self, msg):\r\n        \"\"\"Update follower position\"\"\"\r\n        if not self.is_follower:\r\n            return\r\n\r\n        self.follower_position = (\r\n            msg.pose.pose.position.x,\r\n            msg.pose.pose.position.y)\r\n\r\n    def update_control(self):\r\n        \"\"\"Compute follower velocity to track leader\"\"\"\r\n        if (self.leader_position is None or\r\n            self.follower_position is None or\r\n            self.leader_angle is None):\r\n            return\r\n\r\n        try:\r\n            # Vector from follower to leader\r\n            dx = self.leader_position[0] - self.follower_position[0]\r\n            dy = self.leader_position[1] - self.follower_position[1]\r\n            distance = math.sqrt(dx**2 + dy**2)\r\n\r\n            # Desired position: behind leader by desired_distance\r\n            target_x = self.leader_position[0] - self.desired_distance * math.cos(self.leader_angle)\r\n            target_y = self.leader_position[1] - self.desired_distance * math.sin(self.leader_angle)\r\n\r\n            # Error to target\r\n            error_x = target_x - self.follower_position[0]\r\n            error_y = target_y - self.follower_position[1]\r\n            error_distance = math.sqrt(error_x**2 + error_y**2)\r\n\r\n            # Desired heading\r\n            desired_heading = math.atan2(error_y, error_x)\r\n\r\n            # Create velocity command\r\n            twist = Twist()\r\n            twist.linear.x = self.Kp_linear * error_distance\r\n            twist.angular.z = self.Kp_angular * desired_heading\r\n\r\n            # Publish\r\n            self.vel_pub.publish(twist)\r\n\r\n            self.get_logger().debug(\r\n                f'Distance to leader: {distance:.2f}m, '\r\n                f'error to target: {error_distance:.2f}m')\r\n\r\n        except Exception as e:\r\n            self.get_logger().error(f'Control error: {e}')\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = LeaderFollowerNode()\r\n    try:\r\n        rclpy.spin(node)\r\n    except KeyboardInterrupt:\r\n        pass\r\n    finally:\r\n        node.destroy_node()\r\n        rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,s.jsx)(n.h3,{id:"status-reporter-node",children:"Status Reporter Node"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"File"}),": ",(0,s.jsx)(n.code,{children:"examples/chapter-2-gazebo/lesson-08/status_reporter_node.py"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"#!/usr/bin/env python3\r\n\"\"\"\r\nMonitor and report multi-robot system status\r\nSimulation environment: Gazebo 11+\r\n\"\"\"\r\n\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom nav_msgs.msg import Odometry\r\nimport math\r\nimport time\r\n\r\nclass StatusReporterNode(Node):\r\n    def __init__(self):\r\n        super().__init__('status_reporter')\r\n\r\n        # Tracked robots\r\n        self.robots = {'/robot1': {}, '/robot2': {}}\r\n\r\n        # Subscribe to each robot's odometry\r\n        for robot_ns in self.robots.keys():\r\n            self.create_subscription(\r\n                Odometry,\r\n                f'{robot_ns}/odom',\r\n                lambda msg, ns=robot_ns: self.odom_callback(msg, ns),\r\n                10)\r\n\r\n        # Timer for periodic status reporting\r\n        self.create_timer(2.0, self.report_status)\r\n\r\n        self.get_logger().info('Status reporter initialized')\r\n\r\n    def odom_callback(self, msg, robot_ns):\r\n        \"\"\"Store robot odometry\"\"\"\r\n        self.robots[robot_ns]['position'] = (\r\n            msg.pose.pose.position.x,\r\n            msg.pose.pose.position.y)\r\n        self.robots[robot_ns]['velocity'] = (\r\n            msg.twist.twist.linear.x,\r\n            msg.twist.twist.linear.y)\r\n        self.robots[robot_ns]['last_update'] = time.time()\r\n\r\n    def report_status(self):\r\n        \"\"\"Periodic status report\"\"\"\r\n        try:\r\n            positions = []\r\n            for robot_ns, data in self.robots.items():\r\n                if 'position' in data:\r\n                    positions.append(data['position'])\r\n                    self.get_logger().info(\r\n                        f'{robot_ns}: pos=({data[\"position\"][0]:.2f}, {data[\"position\"][1]:.2f}), '\r\n                        f'vel=({data[\"velocity\"][0]:.2f}, {data[\"velocity\"][1]:.2f})')\r\n\r\n            # Calculate inter-robot distance\r\n            if len(positions) == 2:\r\n                dx = positions[1][0] - positions[0][0]\r\n                dy = positions[1][1] - positions[0][1]\r\n                distance = math.sqrt(dx**2 + dy**2)\r\n                self.get_logger().info(f'Inter-robot distance: {distance:.2f}m')\r\n\r\n        except Exception as e:\r\n            self.get_logger().error(f'Status report error: {e}')\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = StatusReporterNode()\r\n    try:\r\n        rclpy.spin(node)\r\n    except KeyboardInterrupt:\r\n        pass\r\n    finally:\r\n        node.destroy_node()\r\n        rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"layer-2-ai-collaboration-notes",children:"Layer 2: AI Collaboration Notes"}),"\n",(0,s.jsxs)(n.p,{children:["\ud83d\udcac ",(0,s.jsx)(n.strong,{children:"Prompt 1"}),': "How do I coordinate 3 or more robots? The pairwise collision check doesn\'t scale."']}),"\n",(0,s.jsx)(n.p,{children:"Claude suggests:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Use centralized coordinator node (one node knows all positions)"}),"\n",(0,s.jsx)(n.li,{children:"Or implement local collision avoidance (each robot checks nearby robots only)"}),"\n",(0,s.jsx)(n.li,{children:"For 3+ robots, centralized is simpler initially"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["\ud83d\udcac ",(0,s.jsx)(n.strong,{children:"Prompt 2"}),': "My follower always overshoots and oscillates. How do I tune leader-follower?"']}),"\n",(0,s.jsx)(n.p,{children:"Claude recommends:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Reduce Kp_linear and Kp_angular by half"}),"\n",(0,s.jsx)(n.li,{children:"Add small derivative gain (Kd) to dampen oscillation"}),"\n",(0,s.jsx)(n.li,{children:"Increase desired_distance to give follower more space"}),"\n",(0,s.jsx)(n.li,{children:"Test with slow leader motion first"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,s.jsx)(n.h3,{id:"problem-robots-spawn-on-top-of-each-other",children:"Problem: Robots spawn on top of each other"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Cause"}),": Spawn positions not set or set to (0, 0)\r\n",(0,s.jsx)(n.strong,{children:"Solution"}),": Explicitly set ",(0,s.jsx)(n.code,{children:"initial_pose.position.x"})," and ",(0,s.jsx)(n.code,{children:".y"})," in spawn requests"]}),"\n",(0,s.jsxs)(n.h3,{id:"problem-multi-robot-topics-conflict-both-publish-to-cmd_vel",children:["Problem: Multi-robot topics conflict (both publish to ",(0,s.jsx)(n.code,{children:"/cmd_vel"}),")"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Cause"}),": Namespacing not applied in launch file\r\n",(0,s.jsx)(n.strong,{children:"Solution"}),": Use launch file remapping:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"remappings = [('/cmd_vel', f'{robot_ns}/cmd_vel')]\n"})}),"\n",(0,s.jsx)(n.h3,{id:"problem-tf-tree-shows-only-one-robots-frames",children:"Problem: TF tree shows only one robot's frames"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Cause"}),": Only one robot's TF broadcaster running\r\n",(0,s.jsx)(n.strong,{children:"Solution"}),": Each robot needs its own TF broadcaster for its base_link"]}),"\n",(0,s.jsx)(n.h3,{id:"problem-collision-avoidance-activates-when-robots-far-apart",children:"Problem: Collision avoidance activates when robots far apart"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Cause"}),": Min safe distance threshold too large\r\n",(0,s.jsx)(n.strong,{children:"Solution"}),": Reduce ",(0,s.jsx)(n.code,{children:"min_safe_distance"})," (0.3m instead of 0.5m)"]}),"\n",(0,s.jsx)(n.h3,{id:"problem-follower-never-catches-up-to-leader",children:"Problem: Follower never catches up to leader"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Cause"}),": Linear gain (Kp_linear) too small\r\n",(0,s.jsx)(n.strong,{children:"Solution"}),": Increase Kp_linear (0.5 \u2192 1.0)"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"self-assessment-checklist",children:"Self-Assessment Checklist"}),"\n",(0,s.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","I can spawn 2+ robots in Gazebo at different positions"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Each robot has unique namespace (robot1, robot2)"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Robots communicate their positions via odometry topics"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Collision avoidance node monitors distance and stops robots if too close"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Leader-follower node makes follower track leader position"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Status reporter node logs multi-robot system state"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","RViz displays both robots and their sensors correctly"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","I understand how to scale from 2 to 3+ robots"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"capstone-challenge-full-autonomous-system",children:"Capstone Challenge: Full Autonomous System"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Requirements"}),":"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Two identical differential drive robots with sensors"}),"\n",(0,s.jsx)(n.li,{children:"Robot1 (leader) navigates following a preset path"}),"\n",(0,s.jsx)(n.li,{children:"Robot2 (follower) tracks Robot1 while avoiding obstacles"}),"\n",(0,s.jsx)(n.li,{children:"Status reporter logs all robot positions and distances"}),"\n",(0,s.jsx)(n.li,{children:"System runs for 60 seconds without collisions"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Success criteria"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"No collisions between robots"}),"\n",(0,s.jsx)(n.li,{children:"Follower stays within 0.5m of leader"}),"\n",(0,s.jsx)(n.li,{children:"All ROS 2 topics function correctly"}),"\n",(0,s.jsx)(n.li,{children:"RViz visualization shows real-time robot motion"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"key-takeaways",children:"Key Takeaways"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Namespacing is essential"}),": Isolates multi-robot topics"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Centralized coordination scales"}),": One node knows all robot states"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Distance-based avoidance is simple but effective"}),": Works for 2-3 robots"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Leader-follower is powerful"}),": Scales to many robots"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Proper launch file orchestration"}),": Orchestrates complex multi-robot systems"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"chapter-2-complete",children:"Chapter 2 Complete!"}),"\n",(0,s.jsx)(n.p,{children:"You've now mastered:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Gazebo physics simulation"}),"\n",(0,s.jsx)(n.li,{children:"URDF robot modeling"}),"\n",(0,s.jsx)(n.li,{children:"Sensor integration and processing"}),"\n",(0,s.jsx)(n.li,{children:"ROS 2 control and feedback"}),"\n",(0,s.jsx)(n.li,{children:"Multi-robot coordination"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Ready for the next chapter?"})," Chapter 3 (Advanced Simulation with Isaac Sim) builds on these foundations with more realistic physics and AI-powered autonomous systems."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Capstone Status"}),": Complete with three multi-robot coordination nodes and debugging guide."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Duration"}),": 120 minutes (including multi-robot experimentation)"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Files Created"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"examples/chapter-2-gazebo/lesson-08/collision_avoidance_node.py"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"examples/chapter-2-gazebo/lesson-08/leader_follower_node.py"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"examples/chapter-2-gazebo/lesson-08/status_reporter_node.py"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"examples/chapter-2-gazebo/lesson-08/multi-robot-debugging.md"})}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Concepts Covered"}),": 9 (robot namespacing, multi-robot spawning, odometry, collision avoidance, leader-follower pattern, fleet coordination, multi-robot debugging, launch file orchestration, multi-robot safety)"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"chapter-2-summary",children:"Chapter 2 Summary"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Lesson"}),(0,s.jsx)(n.th,{children:"Topic"}),(0,s.jsx)(n.th,{children:"Time"}),(0,s.jsx)(n.th,{children:"Key Output"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"1"}),(0,s.jsx)(n.td,{children:"Gazebo Basics"}),(0,s.jsx)(n.td,{children:"45 min"}),(0,s.jsx)(n.td,{children:"Understand physics engines"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"2"}),(0,s.jsx)(n.td,{children:"URDF Modeling"}),(0,s.jsx)(n.td,{children:"60 min"}),(0,s.jsx)(n.td,{children:"2-link robot URDF"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"3"}),(0,s.jsx)(n.td,{children:"Mobile Robots"}),(0,s.jsx)(n.td,{children:"75 min"}),(0,s.jsx)(n.td,{children:"Differential drive robot"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"4"}),(0,s.jsx)(n.td,{children:"Physics Tuning"}),(0,s.jsx)(n.td,{children:"75 min"}),(0,s.jsx)(n.td,{children:"Optimized physics parameters"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"5"}),(0,s.jsx)(n.td,{children:"Sensor Integration"}),(0,s.jsx)(n.td,{children:"75 min"}),(0,s.jsx)(n.td,{children:"Robot with camera, LiDAR, IMU"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"6"}),(0,s.jsx)(n.td,{children:"Sensor Processing"}),(0,s.jsx)(n.td,{children:"75 min"}),(0,s.jsx)(n.td,{children:"ROS 2 subscriber nodes"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"7"}),(0,s.jsx)(n.td,{children:"ROS 2 Control"}),(0,s.jsx)(n.td,{children:"75 min"}),(0,s.jsx)(n.td,{children:"Joint controllers + feedback"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"8"}),(0,s.jsx)(n.td,{children:"Multi-Robot Capstone"}),(0,s.jsx)(n.td,{children:"120 min"}),(0,s.jsx)(n.td,{children:"Coordinated 2-robot system"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"TOTAL"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Complete Chapter"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"9 hours"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Full autonomous robot system"})})]})]})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"What's Next?"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Chapter 3: Advanced simulation with physics-engine selection, soft-body dynamics, and Isaac Sim"}),"\n",(0,s.jsx)(n.li,{children:"Chapter 4: Humanoid robot design, biped locomotion, and human-robot interaction"}),"\n",(0,s.jsx)(n.li,{children:"Chapter 5: Autonomous navigation, SLAM, and path planning"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Chapter 2 Files Summary"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"9 lesson markdown files"}),"\n",(0,s.jsx)(n.li,{children:"25+ URDF robot models"}),"\n",(0,s.jsx)(n.li,{children:"12+ Python ROS 2 control nodes"}),"\n",(0,s.jsx)(n.li,{children:"4+ test files for validation"}),"\n",(0,s.jsx)(n.li,{children:"Comprehensive troubleshooting guides"}),"\n",(0,s.jsx)(n.li,{children:"Self-assessment checklists"}),"\n",(0,s.jsx)(n.li,{children:"Constitutional compliance: 100% (simulation-first, no hardware, B1 CEFR, 4-Layer pedagogy)"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}}}]);