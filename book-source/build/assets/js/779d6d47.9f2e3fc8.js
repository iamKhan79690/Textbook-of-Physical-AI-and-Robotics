"use strict";(globalThis.webpackChunkai_book=globalThis.webpackChunkai_book||[]).push([[711],{3129:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>a,contentTitle:()=>l,default:()=>m,frontMatter:()=>i,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"Gazebo-Simulation/gazebo-ros2-integration","title":"Lesson 7: Gazebo-ROS 2 Integration","description":"Command robot joints via ROS 2 topics and implement feedback control","source":"@site/docs/03-Gazebo-Simulation/07-gazebo-ros2-integration.md","sourceDirName":"03-Gazebo-Simulation","slug":"/Gazebo-Simulation/gazebo-ros2-integration","permalink":"/docs/Gazebo-Simulation/gazebo-ros2-integration","draft":false,"unlisted":false,"editUrl":"https://github.com/your-org/ai-book/tree/main/docs/03-Gazebo-Simulation/07-gazebo-ros2-integration.md","tags":[],"version":"current","sidebarPosition":8,"frontMatter":{"sidebar_position":8,"title":"Lesson 7: Gazebo-ROS 2 Integration","description":"Command robot joints via ROS 2 topics and implement feedback control"},"sidebar":"tutorialSidebar","previous":{"title":"Lesson 6: Processing Sensor Data","permalink":"/docs/Gazebo-Simulation/processing-sensors"},"next":{"title":"Lesson 8: Multi-Robot Capstone Project","permalink":"/docs/Gazebo-Simulation/multi-robot-capstone"}}');var t=n(4848),s=n(8453);const i={sidebar_position:8,title:"Lesson 7: Gazebo-ROS 2 Integration",description:"Command robot joints via ROS 2 topics and implement feedback control"},l="Lesson 7: Gazebo-ROS 2 Integration (75 minutes)",a={},c=[{value:"Learning Outcomes",id:"learning-outcomes",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Core Concepts (8 Total)",id:"core-concepts-8-total",level:2},{value:"1. Joint Command Interface",id:"1-joint-command-interface",level:3},{value:"2. Joint State Feedback",id:"2-joint-state-feedback",level:3},{value:"3. Twist Messages (Differential Drive)",id:"3-twist-messages-differential-drive",level:3},{value:"4. Differential Drive Kinematics (Control)",id:"4-differential-drive-kinematics-control",level:3},{value:"5. JointTrajectory Messages",id:"5-jointtrajectory-messages",level:3},{value:"6. Proportional (P) Control",id:"6-proportional-p-control",level:3},{value:"7. State Publisher (TF Broadcasting)",id:"7-state-publisher-tf-broadcasting",level:3},{value:"8. Closed-Loop System",id:"8-closed-loop-system",level:3},{value:"Layer 1: Manual Exercise - Publish Commands",id:"layer-1-manual-exercise---publish-commands",level:2},{value:"Exercise 1: Move Differential Drive with Twist",id:"exercise-1-move-differential-drive-with-twist",level:3},{value:"Exercise 2: Subscribe to Joint State",id:"exercise-2-subscribe-to-joint-state",level:3},{value:"Code Examples: Control Nodes",id:"code-examples-control-nodes",level:2},{value:"Differential Drive Controller",id:"differential-drive-controller",level:3},{value:"Joint State Listener",id:"joint-state-listener",level:3},{value:"PID-Based Position Controller",id:"pid-based-position-controller",level:3},{value:"Layer 2: AI Collaboration Notes",id:"layer-2-ai-collaboration-notes",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Problem: Commands published but robot doesn&#39;t move",id:"problem-commands-published-but-robot-doesnt-move",level:3},{value:"Problem: Joint feedback reports wrong values",id:"problem-joint-feedback-reports-wrong-values",level:3},{value:"Problem: Robot moves but too slow or too fast",id:"problem-robot-moves-but-too-slow-or-too-fast",level:3},{value:"Problem: PID controller diverges (huge torques)",id:"problem-pid-controller-diverges-huge-torques",level:3},{value:"Problem: &quot;/left_wheel_joint/effort&quot; topic doesn&#39;t exist",id:"problem-left_wheel_jointeffort-topic-doesnt-exist",level:3},{value:"Self-Assessment Checklist",id:"self-assessment-checklist",level:2},{value:"Key Takeaways",id:"key-takeaways",level:2},{value:"Next Lesson",id:"next-lesson",level:2}];function d(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.header,{children:(0,t.jsx)(r.h1,{id:"lesson-7-gazebo-ros-2-integration-75-minutes",children:"Lesson 7: Gazebo-ROS 2 Integration (75 minutes)"})}),"\n",(0,t.jsx)(r.h2,{id:"learning-outcomes",children:"Learning Outcomes"}),"\n",(0,t.jsx)(r.p,{children:"By the end of this lesson, you will:"}),"\n",(0,t.jsxs)(r.ol,{children:["\n",(0,t.jsx)(r.li,{children:"Publish ROS 2 messages to command robot joints (effort/velocity/position)"}),"\n",(0,t.jsx)(r.li,{children:"Subscribe to joint state feedback and monitor robot configuration"}),"\n",(0,t.jsx)(r.li,{children:"Implement basic proportional feedback control"}),"\n",(0,t.jsx)(r.li,{children:"Command differential drive robots with Twist messages"}),"\n",(0,t.jsx)(r.li,{children:"Coordinate perception (sensors) with control (actuators) in a closed loop"}),"\n"]}),"\n",(0,t.jsx)(r.hr,{}),"\n",(0,t.jsx)(r.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:"Lesson 6 completed (sensor processing)"}),"\n",(0,t.jsx)(r.li,{children:"Understanding of ROS 2 publishers"}),"\n",(0,t.jsx)(r.li,{children:"Basic control theory concepts (setpoint, error, feedback)"}),"\n"]}),"\n",(0,t.jsx)(r.hr,{}),"\n",(0,t.jsx)(r.h2,{id:"core-concepts-8-total",children:"Core Concepts (8 Total)"}),"\n",(0,t.jsx)(r.h3,{id:"1-joint-command-interface",children:"1. Joint Command Interface"}),"\n",(0,t.jsx)(r.p,{children:"ROS 2 joint control via topics:"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Effort"}),": Apply force/torque directly (N or N\u22c5m)"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Velocity"}),": Command desired speed (rad/s)"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Position"}),": Command target angle (rad)"]}),"\n"]}),"\n",(0,t.jsx)(r.p,{children:"Message types:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-python",children:"# Effort control (motors)\r\nstd_msgs.msg.Float64(data=10.0)  # 10 N\u22c5m torque\r\n\r\n# Trajectory control (position + velocity + acceleration)\r\ntrajectory_msgs.msg.JointTrajectory(joint_names=['joint1'], points=[...])\n"})}),"\n",(0,t.jsx)(r.h3,{id:"2-joint-state-feedback",children:"2. Joint State Feedback"}),"\n",(0,t.jsxs)(r.p,{children:["ROS 2 publishes robot state on ",(0,t.jsx)(r.code,{children:"/joint_states"}),":"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-python",children:"sensor_msgs.msg.JointState:\r\n  name: [left_wheel, right_wheel, shoulder, elbow]\r\n  position: [0.5, 0.5, 1.2, -0.8]  # Current angles (rad)\r\n  velocity: [0.1, 0.1, 0.0, 0.0]   # Current speeds (rad/s)\r\n  effort: [5.0, 5.0, 0.0, 0.0]     # Current torques (N\u22c5m)\n"})}),"\n",(0,t.jsx)(r.h3,{id:"3-twist-messages-differential-drive",children:"3. Twist Messages (Differential Drive)"}),"\n",(0,t.jsx)(r.p,{children:"Command differential drive robots with high-level velocity:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-python",children:"geometry_msgs.msg.Twist:\r\n  linear.x: 0.5   # Forward speed (m/s)\r\n  linear.y: 0.0   # Lateral speed (not used for differential drive)\r\n  linear.z: 0.0\r\n  angular.x: 0.0\r\n  angular.y: 0.0\r\n  angular.z: 0.2  # Rotation speed (rad/s)\n"})}),"\n",(0,t.jsx)(r.h3,{id:"4-differential-drive-kinematics-control",children:"4. Differential Drive Kinematics (Control)"}),"\n",(0,t.jsx)(r.p,{children:"Convert Twist \u2192 wheel velocities:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{children:"v_left = (linear_x - angular_z \xd7 wheelbase/2)\r\nv_right = (linear_x + angular_z \xd7 wheelbase/2)\n"})}),"\n",(0,t.jsxs)(r.p,{children:["Where ",(0,t.jsx)(r.code,{children:"wheelbase"})," = distance between left/right wheels"]}),"\n",(0,t.jsx)(r.h3,{id:"5-jointtrajectory-messages",children:"5. JointTrajectory Messages"}),"\n",(0,t.jsx)(r.p,{children:"Command multiple joints with trajectory:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-python",children:"trajectory_msgs.msg.JointTrajectory:\r\n  joint_names: ['shoulder', 'elbow']\r\n  points:\r\n    - positions: [0.0, 0.0]\r\n      velocities: [0.1, 0.1]\r\n      time_from_start: {sec: 1, nsec: 0}\r\n    - positions: [1.57, 0.5]\r\n      velocities: [0.0, 0.0]\r\n      time_from_start: {sec: 3, nsec: 0}\n"})}),"\n",(0,t.jsx)(r.h3,{id:"6-proportional-p-control",children:"6. Proportional (P) Control"}),"\n",(0,t.jsx)(r.p,{children:"Simple feedback loop:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{children:"error = target - current\r\neffort = Kp \xd7 error\n"})}),"\n",(0,t.jsx)(r.p,{children:"Example: Move joint to target position"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-python",children:"target_angle = 1.57  # rad\r\ncurrent_angle = 0.0\r\nKp = 5.0  # Proportional gain\r\n\r\nerror = target_angle - current_angle\r\ntorque = Kp * error  # Publish to joint\n"})}),"\n",(0,t.jsx)(r.h3,{id:"7-state-publisher-tf-broadcasting",children:"7. State Publisher (TF Broadcasting)"}),"\n",(0,t.jsx)(r.p,{children:"Publish robot pose in world frame:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-python",children:'from geometry_msgs.msg import TransformStamped\r\nfrom tf2_ros import TransformBroadcaster\r\n\r\nbroadcaster = TransformBroadcaster(self)\r\ntransform = TransformStamped()\r\ntransform.header.frame_id = "world"\r\ntransform.child_frame_id = "base_link"\r\ntransform.transform.translation.x = 1.0  # Robot position\r\nbroadcaster.sendTransform(transform)\n'})}),"\n",(0,t.jsx)(r.h3,{id:"8-closed-loop-system",children:"8. Closed-Loop System"}),"\n",(0,t.jsx)(r.p,{children:"Full loop: Sense \u2192 Process \u2192 Control \u2192 Execute"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{children:"Sensors (image, LiDAR, IMU)\r\n  \u2193 (ROS 2 topics)\r\nProcessing (edge detection, obstacle detection)\r\n  \u2193 (decision making)\r\nControl (compute effort from sensor data)\r\n  \u2193 (ROS 2 topics)\r\nActuators (wheel motors, arm joints)\r\n  \u2193 (Gazebo simulation)\r\nBack to Sensors (feedback loop)\n"})}),"\n",(0,t.jsx)(r.hr,{}),"\n",(0,t.jsx)(r.h2,{id:"layer-1-manual-exercise---publish-commands",children:"Layer 1: Manual Exercise - Publish Commands"}),"\n",(0,t.jsx)(r.h3,{id:"exercise-1-move-differential-drive-with-twist",children:"Exercise 1: Move Differential Drive with Twist"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:'# Terminal 1: Gazebo with robot\r\ngazebo\r\n\r\n# Terminal 2: Send Twist command (move forward)\r\nros2 topic pub --once /cmd_vel geometry_msgs/Twist "{linear: {x: 0.5, y: 0.0, z: 0.0}, angular: {x: 0.0, y: 0.0, z: 0.0}}"\r\n\r\n# Terminal 3: Monitor odometry\r\nros2 topic echo /odom\n'})}),"\n",(0,t.jsx)(r.h3,{id:"exercise-2-subscribe-to-joint-state",children:"Exercise 2: Subscribe to Joint State"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"# Terminal 1: Gazebo\r\n\r\n# Terminal 2: Watch joint states update\r\nros2 topic echo /joint_states\n"})}),"\n",(0,t.jsx)(r.hr,{}),"\n",(0,t.jsx)(r.h2,{id:"code-examples-control-nodes",children:"Code Examples: Control Nodes"}),"\n",(0,t.jsx)(r.h3,{id:"differential-drive-controller",children:"Differential Drive Controller"}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"File"}),": ",(0,t.jsx)(r.code,{children:"examples/chapter-2-gazebo/lesson-07/differential_drive_controller.py"})]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-python",children:"#!/usr/bin/env python3\r\n\"\"\"\r\nDifferential drive controller (Twist \u2192 wheel efforts)\r\nSimulation environment: Gazebo 11+\r\n\"\"\"\r\n\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom geometry_msgs.msg import Twist\r\nfrom std_msgs.msg import Float64\r\nimport math\r\n\r\nclass DifferentialDriveController(Node):\r\n    def __init__(self):\r\n        super().__init__('diff_drive_controller')\r\n\r\n        # Robot parameters\r\n        self.wheel_radius = 0.05  # meters\r\n        self.wheelbase = 0.15     # distance between left/right wheels\r\n        self.max_torque = 10.0    # Newton\u22c5meters\r\n\r\n        # Publishers for wheel efforts\r\n        self.left_wheel_pub = self.create_publisher(\r\n            Float64, '/left_wheel_joint/effort', 10)\r\n        self.right_wheel_pub = self.create_publisher(\r\n            Float64, '/right_wheel_joint/effort', 10)\r\n\r\n        # Subscriber for velocity commands\r\n        self.vel_sub = self.create_subscription(\r\n            Twist, '/cmd_vel', self.velocity_callback, 10)\r\n\r\n        self.get_logger().info('Differential drive controller initialized')\r\n\r\n    def velocity_callback(self, msg):\r\n        \"\"\"Convert Twist to wheel efforts\"\"\"\r\n        try:\r\n            # Extract linear and angular velocity\r\n            v_linear = msg.linear.x      # m/s\r\n            v_angular = msg.angular.z    # rad/s\r\n\r\n            # Differential drive kinematics\r\n            # v_left = v_linear - (wheelbase/2) * v_angular\r\n            # v_right = v_linear + (wheelbase/2) * v_angular\r\n            v_left = v_linear - (self.wheelbase / 2.0) * v_angular\r\n            v_right = v_linear + (self.wheelbase / 2.0) * v_angular\r\n\r\n            # Convert velocity to motor effort (simple proportional control)\r\n            # effort = velocity / wheel_radius \xd7 Kp\r\n            Kp = 2.0\r\n            effort_left = (v_left / self.wheel_radius) * Kp\r\n            effort_right = (v_right / self.wheel_radius) * Kp\r\n\r\n            # Clamp to max torque\r\n            effort_left = max(-self.max_torque, min(self.max_torque, effort_left))\r\n            effort_right = max(-self.max_torque, min(self.max_torque, effort_right))\r\n\r\n            # Publish efforts\r\n            self.left_wheel_pub.publish(Float64(data=effort_left))\r\n            self.right_wheel_pub.publish(Float64(data=effort_right))\r\n\r\n            self.get_logger().debug(\r\n                f'Twist: linear={v_linear:.2f}, angular={v_angular:.2f} \u2192 '\r\n                f'efforts: left={effort_left:.2f}, right={effort_right:.2f}')\r\n\r\n        except Exception as e:\r\n            self.get_logger().error(f'Control error: {e}')\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = DifferentialDriveController()\r\n    try:\r\n        rclpy.spin(node)\r\n    except KeyboardInterrupt:\r\n        pass\r\n    finally:\r\n        node.destroy_node()\r\n        rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,t.jsx)(r.h3,{id:"joint-state-listener",children:"Joint State Listener"}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"File"}),": ",(0,t.jsx)(r.code,{children:"examples/chapter-2-gazebo/lesson-07/joint_state_listener.py"})]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-python",children:"#!/usr/bin/env python3\r\n\"\"\"\r\nSubscribe to joint states and monitor robot configuration\r\nSimulation environment: Gazebo 11+\r\n\"\"\"\r\n\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom sensor_msgs.msg import JointState\r\n\r\nclass JointStateListener(Node):\r\n    def __init__(self):\r\n        super().__init__('joint_state_listener')\r\n\r\n        self.joint_sub = self.create_subscription(\r\n            JointState, '/joint_states', self.joint_callback, 10)\r\n\r\n        self.get_logger().info('Joint state listener initialized')\r\n\r\n    def joint_callback(self, msg):\r\n        \"\"\"Process joint state feedback\"\"\"\r\n        try:\r\n            # Log all joint states\r\n            self.get_logger().info('Joint states:')\r\n            for i, name in enumerate(msg.name):\r\n                pos = msg.position[i] if i < len(msg.position) else 0.0\r\n                vel = msg.velocity[i] if i < len(msg.velocity) else 0.0\r\n                eff = msg.effort[i] if i < len(msg.effort) else 0.0\r\n                self.get_logger().info(\r\n                    f'  {name}: pos={pos:.3f} rad, vel={vel:.3f} rad/s, '\r\n                    f'effort={eff:.3f} N\u22c5m')\r\n\r\n        except Exception as e:\r\n            self.get_logger().error(f'Error processing joint state: {e}')\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = JointStateListener()\r\n    try:\r\n        rclpy.spin(node)\r\n    except KeyboardInterrupt:\r\n        pass\r\n    finally:\r\n        node.destroy_node()\r\n        rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,t.jsx)(r.h3,{id:"pid-based-position-controller",children:"PID-Based Position Controller"}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"File"}),": ",(0,t.jsx)(r.code,{children:"examples/chapter-2-gazebo/lesson-07/pid_control_demo.py"})]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-python",children:"#!/usr/bin/env python3\r\n\"\"\"\r\nPID feedback control for joint position\r\nSimulation environment: Gazebo 11+\r\n\"\"\"\r\n\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom sensor_msgs.msg import JointState\r\nfrom std_msgs.msg import Float64\r\nimport time\r\n\r\nclass PIDController(Node):\r\n    def __init__(self):\r\n        super().__init__('pid_controller')\r\n\r\n        # Target position\r\n        self.target_position = 1.57  # 90 degrees (radians)\r\n\r\n        # PID gains\r\n        self.Kp = 5.0    # Proportional\r\n        self.Ki = 0.1    # Integral\r\n        self.Kd = 0.5    # Derivative\r\n\r\n        # State tracking\r\n        self.last_error = 0.0\r\n        self.integral_error = 0.0\r\n        self.last_time = time.time()\r\n\r\n        # Publishers and subscribers\r\n        self.joint_effort_pub = self.create_publisher(\r\n            Float64, '/shoulder_joint/effort', 10)\r\n\r\n        self.joint_state_sub = self.create_subscription(\r\n            JointState, '/joint_states', self.joint_callback, 10)\r\n\r\n        self.get_logger().info(f'PID controller initialized, target: {self.target_position:.2f} rad')\r\n\r\n    def joint_callback(self, msg):\r\n        \"\"\"PID control loop\"\"\"\r\n        try:\r\n            # Find shoulder joint in state message\r\n            joint_index = msg.name.index('shoulder_joint')\r\n            current_position = msg.position[joint_index]\r\n\r\n            # Calculate error\r\n            error = self.target_position - current_position\r\n\r\n            # Calculate time delta\r\n            current_time = time.time()\r\n            dt = current_time - self.last_time\r\n            self.last_time = current_time\r\n\r\n            # Proportional term\r\n            p_term = self.Kp * error\r\n\r\n            # Integral term\r\n            self.integral_error += error * dt\r\n            i_term = self.Ki * self.integral_error\r\n\r\n            # Derivative term\r\n            d_term = self.Kd * (error - self.last_error) / dt if dt > 0 else 0\r\n            self.last_error = error\r\n\r\n            # Total effort\r\n            effort = p_term + i_term + d_term\r\n\r\n            # Clamp to max\r\n            max_effort = 10.0\r\n            effort = max(-max_effort, min(max_effort, effort))\r\n\r\n            # Publish\r\n            self.joint_effort_pub.publish(Float64(data=effort))\r\n\r\n            self.get_logger().debug(\r\n                f'PID: pos={current_position:.3f}, target={self.target_position:.3f}, '\r\n                f'error={error:.3f}, effort={effort:.3f}')\r\n\r\n        except (ValueError, IndexError) as e:\r\n            self.get_logger().warn(f'Joint not found or error: {e}')\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = PIDController()\r\n    try:\r\n        rclpy.spin(node)\r\n    except KeyboardInterrupt:\r\n        pass\r\n    finally:\r\n        node.destroy_node()\r\n        rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,t.jsx)(r.hr,{}),"\n",(0,t.jsx)(r.h2,{id:"layer-2-ai-collaboration-notes",children:"Layer 2: AI Collaboration Notes"}),"\n",(0,t.jsxs)(r.p,{children:["\ud83d\udcac ",(0,t.jsx)(r.strong,{children:"Prompt 1"}),": \"My Twist command doesn't move the robot. What's wrong?\""]}),"\n",(0,t.jsx)(r.p,{children:"Claude checks:"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:["Is differential drive controller running? (",(0,t.jsx)(r.code,{children:"ros2 node list"}),")"]}),"\n",(0,t.jsxs)(r.li,{children:["Is ",(0,t.jsx)(r.code,{children:"/cmd_vel"})," topic being received? (",(0,t.jsx)(r.code,{children:"ros2 topic hz /cmd_vel"}),")"]}),"\n",(0,t.jsxs)(r.li,{children:["Are wheel effort topics being published? (",(0,t.jsx)(r.code,{children:"ros2 topic list | grep effort"}),")"]}),"\n",(0,t.jsx)(r.li,{children:"Check Gazebo has joint controllers enabled"}),"\n"]}),"\n",(0,t.jsxs)(r.p,{children:["\ud83d\udcac ",(0,t.jsx)(r.strong,{children:"Prompt 2"}),': "My PID controller oscillates around the target. How do I tune it?"']}),"\n",(0,t.jsx)(r.p,{children:"Claude suggests:"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:"Start with Kp only (set Ki, Kd to 0)"}),"\n",(0,t.jsx)(r.li,{children:"Increase Kp until oscillation starts"}),"\n",(0,t.jsx)(r.li,{children:"Back off Kp by 50%"}),"\n",(0,t.jsx)(r.li,{children:"Add small Kd to dampen oscillation"}),"\n",(0,t.jsx)(r.li,{children:"Add Ki to eliminate steady-state error"}),"\n"]}),"\n",(0,t.jsx)(r.hr,{}),"\n",(0,t.jsx)(r.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,t.jsx)(r.h3,{id:"problem-commands-published-but-robot-doesnt-move",children:"Problem: Commands published but robot doesn't move"}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Cause"}),": Effort topic wrong name or controller not reading it\r\n",(0,t.jsx)(r.strong,{children:"Solution"}),":"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:'# Verify effort topic\r\nros2 topic list | grep -i effort\r\n\r\n# Manually publish test command\r\nros2 topic pub --once /left_wheel_joint/effort std_msgs/Float64 "{data: 5.0}"\n'})}),"\n",(0,t.jsx)(r.h3,{id:"problem-joint-feedback-reports-wrong-values",children:"Problem: Joint feedback reports wrong values"}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Cause"}),": Joint state publisher not running or joint name mismatch\r\n",(0,t.jsx)(r.strong,{children:"Solution"}),":"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"# Check joint states available\r\nros2 topic echo /joint_states\n"})}),"\n",(0,t.jsx)(r.h3,{id:"problem-robot-moves-but-too-slow-or-too-fast",children:"Problem: Robot moves but too slow or too fast"}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Cause"}),": Scaling factor (Kp) wrong\r\n",(0,t.jsx)(r.strong,{children:"Solution"}),": Adjust ",(0,t.jsx)(r.code,{children:"Kp"})," in controller (lower = slower, higher = faster)"]}),"\n",(0,t.jsx)(r.h3,{id:"problem-pid-controller-diverges-huge-torques",children:"Problem: PID controller diverges (huge torques)"}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Cause"}),": Gains too aggressive or integral term accumulating\r\n",(0,t.jsx)(r.strong,{children:"Solution"}),":"]}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:"Reduce Kp"}),"\n",(0,t.jsx)(r.li,{children:"Reduce Ki (or set to 0)"}),"\n",(0,t.jsx)(r.li,{children:"Add Kd for damping"}),"\n"]}),"\n",(0,t.jsx)(r.h3,{id:"problem-left_wheel_jointeffort-topic-doesnt-exist",children:'Problem: "/left_wheel_joint/effort" topic doesn\'t exist'}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Cause"}),": Joint controller plugin not loaded in Gazebo\r\n",(0,t.jsx)(r.strong,{children:"Solution"}),": Add gazebo_ros joint controller plugins to URDF"]}),"\n",(0,t.jsx)(r.hr,{}),"\n",(0,t.jsx)(r.h2,{id:"self-assessment-checklist",children:"Self-Assessment Checklist"}),"\n",(0,t.jsxs)(r.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(r.li,{className:"task-list-item",children:[(0,t.jsx)(r.input,{type:"checkbox",disabled:!0})," ","I can publish Twist messages to move a differential drive robot"]}),"\n",(0,t.jsxs)(r.li,{className:"task-list-item",children:[(0,t.jsx)(r.input,{type:"checkbox",disabled:!0})," ","I can subscribe to joint state and extract position/velocity/effort values"]}),"\n",(0,t.jsxs)(r.li,{className:"task-list-item",children:[(0,t.jsx)(r.input,{type:"checkbox",disabled:!0})," ","I've implemented proportional control for a single joint"]}),"\n",(0,t.jsxs)(r.li,{className:"task-list-item",children:[(0,t.jsx)(r.input,{type:"checkbox",disabled:!0})," ","I've converted Twist (linear, angular velocity) to wheel efforts using kinematics"]}),"\n",(0,t.jsxs)(r.li,{className:"task-list-item",children:[(0,t.jsx)(r.input,{type:"checkbox",disabled:!0})," ","I can close the perception-action loop (sensor \u2192 process \u2192 control \u2192 actuate)"]}),"\n",(0,t.jsxs)(r.li,{className:"task-list-item",children:[(0,t.jsx)(r.input,{type:"checkbox",disabled:!0})," ","My robot responds predictably to ROS 2 commands"]}),"\n"]}),"\n",(0,t.jsx)(r.hr,{}),"\n",(0,t.jsx)(r.h2,{id:"key-takeaways",children:"Key Takeaways"}),"\n",(0,t.jsxs)(r.ol,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Joint control is topic-based"}),": Publish efforts/velocities to command motors"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Joint state feedback enables closed-loop control"}),": Monitor what you've achieved"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Proportional control works but oscillates"}),": Add derivative and integral for smoothness"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Differential drive kinematics converts Twist \u2192 wheel efforts"}),": Essential for mobile robots"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Closed-loop systems need feedback"}),": Sensors + control = autonomous behavior"]}),"\n"]}),"\n",(0,t.jsx)(r.hr,{}),"\n",(0,t.jsx)(r.h2,{id:"next-lesson",children:"Next Lesson"}),"\n",(0,t.jsx)(r.p,{children:"In Lesson 8, you'll coordinate multiple robots, implement collision avoidance, and build a full autonomous system."}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.a,{href:"./lesson-08-multi-robot-capstone.md",children:"Go to Lesson 8: Multi-Robot Capstone \u2192"})}),"\n",(0,t.jsx)(r.hr,{}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Lesson Status"}),": Complete with three control node examples (differential drive, state listener, PID controller)."]}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Duration"}),": 75 minutes (including feedback control experimentation)"]}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Files Created"}),":"]}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.code,{children:"examples/chapter-2-gazebo/lesson-07/differential_drive_controller.py"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.code,{children:"examples/chapter-2-gazebo/lesson-07/joint_state_listener.py"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.code,{children:"examples/chapter-2-gazebo/lesson-07/pid_control_demo.py"})}),"\n"]}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Concepts Covered"}),": 8 (joint command interface, joint state feedback, Twist messages, differential drive kinematics, JointTrajectory, proportional control, state publishing, closed-loop systems)"]})]})}function m(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,r,n)=>{n.d(r,{R:()=>i,x:()=>l});var o=n(6540);const t={},s=o.createContext(t);function i(e){const r=o.useContext(s);return o.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function l(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),o.createElement(s.Provider,{value:r},e.children)}}}]);