<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Autonomous-Navigation/multi-sensor-perception-and-fusion" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Lesson 7: Multi-Sensor Perception and Fusion | AI-Native Book</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://your-docusaurus-site.example.com/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://your-docusaurus-site.example.com/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://your-docusaurus-site.example.com/docs/Autonomous-Navigation/multi-sensor-perception-and-fusion"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Lesson 7: Multi-Sensor Perception and Fusion | AI-Native Book"><meta data-rh="true" name="description" content="Duration Unlimited | Priority Lesson 1 or 3"><meta data-rh="true" property="og:description" content="Duration Unlimited | Priority Lesson 1 or 3"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://your-docusaurus-site.example.com/docs/Autonomous-Navigation/multi-sensor-perception-and-fusion"><link data-rh="true" rel="alternate" href="https://your-docusaurus-site.example.com/docs/Autonomous-Navigation/multi-sensor-perception-and-fusion" hreflang="en"><link data-rh="true" rel="alternate" href="https://your-docusaurus-site.example.com/docs/Autonomous-Navigation/multi-sensor-perception-and-fusion" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Lesson 7: Multi-Sensor Perception and Fusion","item":"https://your-docusaurus-site.example.com/docs/Autonomous-Navigation/multi-sensor-perception-and-fusion"}]}</script><link rel="stylesheet" href="/assets/css/styles.e8e42a22.css">
<script src="/assets/js/runtime~main.2a2f2056.js" defer="defer"></script>
<script src="/assets/js/main.903acabd.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="AI Book Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="AI Book Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">AI-Native Book</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Book</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/your-org/ai-book" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/"><span title="Welcome to the Physical AI Robotics Book" class="linkLabel_WmDU">Welcome to the Physical AI Robotics Book</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/category/-getting-started"><span title="ðŸš€ Getting Started" class="categoryLinkLabel_W154">ðŸš€ Getting Started</span></a><button aria-label="Expand sidebar category &#x27;ðŸš€ Getting Started&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/category/-chapter-1-ros-2-basics"><span title="ðŸ“– Chapter 1: ROS 2 Basics" class="categoryLinkLabel_W154">ðŸ“– Chapter 1: ROS 2 Basics</span></a><button aria-label="Expand sidebar category &#x27;ðŸ“– Chapter 1: ROS 2 Basics&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/Gazebo-Simulation/intro"><span title="Gazebo-Simulation" class="categoryLinkLabel_W154">Gazebo-Simulation</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/Autonomous-Navigation/intro"><span title="Autonomous-Navigation" class="categoryLinkLabel_W154">Autonomous-Navigation</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Autonomous-Navigation/intro"><span title="Chapter 3: Autonomous Navigation" class="linkLabel_WmDU">Chapter 3: Autonomous Navigation</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Autonomous-Navigation/navigation-and-localization-overview"><span title="Lesson 1: Navigation and Localization Overview" class="linkLabel_WmDU">Lesson 1: Navigation and Localization Overview</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Autonomous-Navigation/visual-slam-systems"><span title="Lesson 2: Visual SLAM Systems" class="linkLabel_WmDU">Lesson 2: Visual SLAM Systems</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Autonomous-Navigation/introduction-to-isaac-sim"><span title="Lesson 3: Introduction to Isaac Sim" class="linkLabel_WmDU">Lesson 3: Introduction to Isaac Sim</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Autonomous-Navigation/nav2-path-planning-stack"><span title="Lesson 4: Nav2 Path Planning Stack" class="linkLabel_WmDU">Lesson 4: Nav2 Path Planning Stack</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Autonomous-Navigation/obstacle-avoidance-and-dynamic-environments"><span title="Lesson 5: Obstacle Avoidance and Dynamic Environments" class="linkLabel_WmDU">Lesson 5: Obstacle Avoidance and Dynamic Environments</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Autonomous-Navigation/autonomous-humanoid-navigation"><span title="Lesson 6: Autonomous Humanoid Navigation" class="linkLabel_WmDU">Lesson 6: Autonomous Humanoid Navigation</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/Autonomous-Navigation/multi-sensor-perception-and-fusion"><span title="Lesson 7: Multi-Sensor Perception and Fusion" class="linkLabel_WmDU">Lesson 7: Multi-Sensor Perception and Fusion</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Autonomous-Navigation/capstone-mission"><span title="Lesson 8: Capstone - Autonomous Navigation End-to-End" class="linkLabel_WmDU">Lesson 8: Capstone - Autonomous Navigation End-to-End</span></a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Autonomous-Navigation</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Lesson 7: Multi-Sensor Perception and Fusion</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div style="display:flex;flex-wrap:wrap;gap:12px;margin-bottom:24px;align-items:center"><div class="notAuthMessage_gyQm"><p>ðŸ”’ Please <a href="/signin">sign in</a> to access Urdu translation</p></div></div><div class="theme-doc-markdown markdown"><header><h1>Lesson 7: Multi-Sensor Perception and Fusion</h1></header>
<p><strong>Duration</strong>: 3 hours | <strong>Level</strong>: Unlimited | <strong>Priority</strong>: P3 | <strong>Prerequisite</strong>: Lesson 1 or 3</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="learning-outcomes">Learning Outcomes<a href="#learning-outcomes" class="hash-link" aria-label="Direct link to Learning Outcomes" title="Direct link to Learning Outcomes" translate="no">â€‹</a></h2>
<p>By the end of this lesson, you will be able to:</p>
<ol>
<li class=""><strong>Explain</strong> sensor characteristics (camera, LiDAR, IMU) and their trade-offs</li>
<li class=""><strong>Implement</strong> temporal synchronization using ROS 2 message_filters</li>
<li class=""><strong>Design</strong> covariance-weighted sensor fusion strategies</li>
<li class=""><strong>Measure</strong> accuracy improvements from multi-sensor fusion (&gt;20% target)</li>
<li class=""><strong>Handle</strong> sensor failures and gracefully degrade</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="layer-1-foundation">Layer 1: Foundation<a href="#layer-1-foundation" class="hash-link" aria-label="Direct link to Layer 1: Foundation" title="Direct link to Layer 1: Foundation" translate="no">â€‹</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="71-sensor-characteristics">7.1 Sensor Characteristics<a href="#71-sensor-characteristics" class="hash-link" aria-label="Direct link to 7.1 Sensor Characteristics" title="Direct link to 7.1 Sensor Characteristics" translate="no">â€‹</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="camera-visual">Camera (Visual)<a href="#camera-visual" class="hash-link" aria-label="Direct link to Camera (Visual)" title="Direct link to Camera (Visual)" translate="no">â€‹</a></h4>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Strengths:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€ Rich visual information (features, colors, textures)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€ Works well in daylight/indoor with good lighting</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â””â”€ Scalable (multiple cameras cheap)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Weaknesses:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€ Fails in darkness or low contrast</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€ Motion blur at high speed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€ Computationally expensive feature extraction</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â””â”€ Sensitive to lighting changes</span><br></span></code></pre></div></div>
<p><strong>Good for</strong>: Feature-based SLAM, object detection</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="lidar-light-detection-and-ranging">LiDAR (Light Detection and Ranging)<a href="#lidar-light-detection-and-ranging" class="hash-link" aria-label="Direct link to LiDAR (Light Detection and Ranging)" title="Direct link to LiDAR (Light Detection and Ranging)" translate="no">â€‹</a></h4>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Strengths:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€ Robust distance measurement (works day/night)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€ 3D point cloud, good range (5-30m)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€ Less affected by lighting</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â””â”€ Direct depth, no scale ambiguity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Weaknesses:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€ Sparse point clouds (vs. dense images)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€ Expensive hardware</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€ Doesn&#x27;t capture color/texture</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â””â”€ Limited by range and reflectivity</span><br></span></code></pre></div></div>
<p><strong>Good for</strong>: Range sensing, obstacle detection</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="imu-accelerometer--gyroscope">IMU (Accelerometer + Gyroscope)<a href="#imu-accelerometer--gyroscope" class="hash-link" aria-label="Direct link to IMU (Accelerometer + Gyroscope)" title="Direct link to IMU (Accelerometer + Gyroscope)" translate="no">â€‹</a></h4>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Strengths:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€ Immediate motion feedback (no latency)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€ Works anywhere (indoors/outdoors, dark/light)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€ Small, cheap, lightweight</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â””â”€ No external dependencies</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Weaknesses:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€ Accelerometer drifts (integration error accumulates)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€ Gyroscope drifts (bias accumulates)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€ Noisy measurements</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â””â”€ Can&#x27;t estimate absolute position alone</span><br></span></code></pre></div></div>
<p><strong>Good for</strong>: Motion tracking, orientation</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="72-sensor-fusion-motivation">7.2 Sensor Fusion Motivation<a href="#72-sensor-fusion-motivation" class="hash-link" aria-label="Direct link to 7.2 Sensor Fusion Motivation" title="Direct link to 7.2 Sensor Fusion Motivation" translate="no">â€‹</a></h3>
<p><strong>Single sensor limitations</strong>:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Camera in dark room:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€ Can&#x27;t see features â†’ SLAM fails</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â””â”€ Output: No pose estimate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LiDAR in featureless corridor:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€ All similar point clouds â†’ ambiguous</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â””â”€ Output: Multiple possible poses</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IMU alone:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€ Drifts over time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â””â”€ Output: Rough estimate, diverges</span><br></span></code></pre></div></div>
<p><strong>Fused sensors</strong>:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Camera + LiDAR + IMU:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€ Camera: rich features (when light available)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€ LiDAR: robust range (works day/night)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€ IMU: immediate motion feedback</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â””â”€ Output: Robust pose with 20%+ accuracy improvement</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="73-fusion-architectures">7.3 Fusion Architectures<a href="#73-fusion-architectures" class="hash-link" aria-label="Direct link to 7.3 Fusion Architectures" title="Direct link to 7.3 Fusion Architectures" translate="no">â€‹</a></h3>
<p><strong>Tightly-coupled fusion</strong>:</p>
<ul>
<li class="">All sensors feed into single optimizer</li>
<li class="">Best accuracy, most complex</li>
<li class="">Example: Visual-inertial SLAM</li>
</ul>
<p><strong>Loosely-coupled fusion</strong>:</p>
<ul>
<li class="">Each sensor produces independent pose estimate</li>
<li class="">Estimates combined via weighted average</li>
<li class="">Simpler, sufficient for most applications</li>
<li class=""><strong>Our approach</strong>: Loosely-coupled with covariance weighting</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Visual odometry â†’ pose (with covariance)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      â”‚</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      â”œâ†’ Weighted fusion â†’ final pose</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      â”‚</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LiDAR odometry â†’ pose (with covariance)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      â”‚</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IMU-based estimate â†’ orientation (with covariance)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="74-covariance-weighted-fusion">7.4 Covariance-Weighted Fusion<a href="#74-covariance-weighted-fusion" class="hash-link" aria-label="Direct link to 7.4 Covariance-Weighted Fusion" title="Direct link to 7.4 Covariance-Weighted Fusion" translate="no">â€‹</a></h3>
<p>Each sensor produces:</p>
<ul>
<li class=""><strong>State estimate</strong>: Position and orientation</li>
<li class=""><strong>Covariance</strong>: Uncertainty matrix (how confident?)</li>
</ul>
<p><strong>Fusion rule</strong> (Kalman filter-like):</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Measurement 1: pose_1, cov_1 (high confidence, low covariance)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Measurement 2: pose_2, cov_2 (low confidence, high covariance)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Fused estimate = (cov_2*pose_1 + cov_1*pose_2) / (cov_1 + cov_2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Intuition: Weight measurements by inverse covariance</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="layer-2-collaboration-ros-2-integration">Layer 2: Collaboration (ROS 2 Integration)<a href="#layer-2-collaboration-ros-2-integration" class="hash-link" aria-label="Direct link to Layer 2: Collaboration (ROS 2 Integration)" title="Direct link to Layer 2: Collaboration (ROS 2 Integration)" translate="no">â€‹</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="21-temporal-synchronization">2.1 Temporal Synchronization<a href="#21-temporal-synchronization" class="hash-link" aria-label="Direct link to 2.1 Temporal Synchronization" title="Direct link to 2.1 Temporal Synchronization" translate="no">â€‹</a></h3>
<p><strong>Challenge</strong>: Sensors have different frequencies and latencies</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Camera @ 30 Hz:    [    @0.1s   @0.2s   @0.3s   ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LiDAR @ 10 Hz:     [   @0.0s            @0.2s  ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IMU @ 100 Hz:      [@ @ @ @ @ @ @ @ @ @ @ @ @ @ ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">How do we combine at same time?</span><br></span></code></pre></div></div>
<p><strong>Solution</strong>: <code>message_filters</code> with exact/approximate time synchronization</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="22-using-message_filters-for-synchronization">2.2 Using message_filters for Synchronization<a href="#22-using-message_filters-for-synchronization" class="hash-link" aria-label="Direct link to 2.2 Using message_filters for Synchronization" title="Direct link to 2.2 Using message_filters for Synchronization" translate="no">â€‹</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># code_examples/temporal_sync_handler.py</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> rclpy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> message_filters </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Subscriber</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ApproximateTimeSynchronizer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> geometry_msgs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">msg </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> PoseStamped</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sensor_msgs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">msg </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Image</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Imu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">SensorFusionNode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rclpy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Node</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">__init__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin">super</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">__init__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;sensor_fusion&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Create subscribers</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        visual_sub </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Subscriber</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> PoseStamped</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/camera/odometry&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        lidar_sub </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Subscriber</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> PoseStamped</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/lidar/odometry&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        imu_sub </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Subscriber</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Imu</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/imu/data&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Synchronize messages</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># ApproximateTimeSynchronizer allows time slew (0.1s tolerance)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sync </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ApproximateTimeSynchronizer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">visual_sub</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> lidar_sub</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> imu_sub</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            queue_size</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            slop</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0.1</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 100ms tolerance</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sync</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">registerCallback</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fusion_callback</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">fusion_callback</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> visual</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> lidar</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> imu</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        Called when all three messages are available</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        within 100ms of each other</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fuse_measurements</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">visual</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> lidar</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> imu</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="23-sensor-fusion-node-architecture">2.3 Sensor Fusion Node Architecture<a href="#23-sensor-fusion-node-architecture" class="hash-link" aria-label="Direct link to 2.3 Sensor Fusion Node Architecture" title="Direct link to 2.3 Sensor Fusion Node Architecture" translate="no">â€‹</a></h3>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># sensor_fusion_node_config.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">sensor_fusion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">input_topics</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">visual_odometry</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/camera/odometry&quot;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># from SLAM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">lidar_odometry</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/lidar/odometry&quot;</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># from LiDAR-SLAM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">imu_data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/imu/data&quot;</span><span class="token plain">               </span><span class="token comment" style="color:#999988;font-style:italic"># raw IMU</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">output_topics</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">fused_pose</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/fused/odometry&quot;</span><span class="token plain">       </span><span class="token comment" style="color:#999988;font-style:italic"># fused estimate</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">diagnostics</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/fused/diagnostics&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">fusion_parameters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">use_visual</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain">                     </span><span class="token comment" style="color:#999988;font-style:italic"># enable camera odometry</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">use_lidar</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain">                      </span><span class="token comment" style="color:#999988;font-style:italic"># enable LiDAR odometry</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">use_imu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain">                        </span><span class="token comment" style="color:#999988;font-style:italic"># enable IMU</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">sync_tolerance</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.1</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># seconds (100ms)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Weighting (lower covariance = higher weight)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">visual_weight</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.0</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic"># reference weight</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">lidar_weight</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.5</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># LiDAR slightly less trusted</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">imu_weight</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2.0</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># IMU least trusted for position</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">failure_modes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">visual_timeout</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2.0</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># seconds until visual considered dead</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">lidar_timeout</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">imu_timeout</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">fallback_sensor</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;lidar&quot;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># use this if others fail</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="layer-3-intelligence-fusion-tuning">Layer 3: Intelligence (Fusion Tuning)<a href="#layer-3-intelligence-fusion-tuning" class="hash-link" aria-label="Direct link to Layer 3: Intelligence (Fusion Tuning)" title="Direct link to Layer 3: Intelligence (Fusion Tuning)" translate="no">â€‹</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="31-covariance-tuning">3.1 Covariance Tuning<a href="#31-covariance-tuning" class="hash-link" aria-label="Direct link to 3.1 Covariance Tuning" title="Direct link to 3.1 Covariance Tuning" translate="no">â€‹</a></h3>
<p>Each sensor publishes odometry with covariance matrix:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">compute_covariance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sensor_noise</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> measurement_error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    Covariance = measure of uncertainty</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    Low covariance (0.01) = high confidence</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    High covariance (1.0) = low confidence</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">eye</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> measurement_error</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Visual odometry covariance</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Usually low in well-lit scenes, high in darkness</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">visual_cov </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.05</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># confident in daylight</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># LiDAR odometry covariance</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Usually low, except in featureless corridors</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lidar_cov </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.10</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic"># medium confidence</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># IMU covariance</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># High initially, increases with time (drift)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">imu_cov_initial </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.5</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># low confidence</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">imu_cov_over_time </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> imu_cov_initial </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> drift_rate </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> time</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="32-failure-mode-handling">3.2 Failure Mode Handling<a href="#32-failure-mode-handling" class="hash-link" aria-label="Direct link to 3.2 Failure Mode Handling" title="Direct link to 3.2 Failure Mode Handling" translate="no">â€‹</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># code_examples/fusion_failure_handling.py</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">FusionWithFailover</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rclpy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Node</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">__init__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">active_sensors </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&#x27;visual&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;lidar&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;imu&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">last_message_time </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&#x27;visual&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;lidar&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;imu&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">check_sensor_health</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;Check which sensors are producing data&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        current_time </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get_clock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">now</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> sensor </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">active_sensors</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">keys</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">last_message_time</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">sensor</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">is</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">continue</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            time_since_message </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">current_time </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                               self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">last_message_time</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">sensor</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">nanoseconds </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1e9</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> time_since_message </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">timeout</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">sensor</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get_logger</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">warn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">sensor</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c"> timeout - disabling&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">active_sensors</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">sensor</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">False</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">active_sensors</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">sensor</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">select_fallback</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;Use available sensor if others fail&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">active_sensors</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;visual&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;visual&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">active_sensors</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;lidar&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;lidar&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">active_sensors</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;imu&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;imu&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># all sensors failed!</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="33-measuring-fusion-performance">3.3 Measuring Fusion Performance<a href="#33-measuring-fusion-performance" class="hash-link" aria-label="Direct link to 3.3 Measuring Fusion Performance" title="Direct link to 3.3 Measuring Fusion Performance" translate="no">â€‹</a></h3>
<p><strong>Ground truth comparison</strong>:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Compare fused pose to ground truth</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">error_before </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> compute_ate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">visual_only</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ground_truth</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">error_after </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> compute_ate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fused_pose</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ground_truth</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">improvement </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">error_before </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> error_after</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> error_before </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Target: &gt;20% improvement</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="layer-4-advanced">Layer 4: Advanced<a href="#layer-4-advanced" class="hash-link" aria-label="Direct link to Layer 4: Advanced" title="Direct link to Layer 4: Advanced" translate="no">â€‹</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="41-extended-kalman-filter-ekf-fusion">4.1 Extended Kalman Filter (EKF) Fusion<a href="#41-extended-kalman-filter-ekf-fusion" class="hash-link" aria-label="Direct link to 4.1 Extended Kalman Filter (EKF) Fusion" title="Direct link to 4.1 Extended Kalman Filter (EKF) Fusion" translate="no">â€‹</a></h3>
<p>More advanced than simple weighted averaging:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">EKF maintains:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€ State: [x, y, theta, vx, vy, vtheta]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€ Covariance: Uncertainty in each state variable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â””â”€ Update cycle:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    1. Predict: Use motion model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    2. Measure: Receive sensor measurements</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3. Correct: Weight update by sensor covariance</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    4. Repeat</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="summary">Summary<a href="#summary" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary" translate="no">â€‹</a></h2>
<table><thead><tr><th>Concept</th><th>Key Insight</th></tr></thead><tbody><tr><td><strong>Sensor fusion</strong></td><td>Combines strengths, mitigates weaknesses</td></tr><tr><td><strong>Covariance</strong></td><td>Measures uncertainty; inverse of confidence</td></tr><tr><td><strong>Synchronization</strong></td><td>Temporal alignment critical for fusion</td></tr><tr><td><strong>Loosely-coupled</strong></td><td>Simple, sufficient for most applications</td></tr><tr><td><strong>Failure handling</strong></td><td>Monitor sensor health, fallback gracefully</td></tr></tbody></table>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="code-examples">Code Examples<a href="#code-examples" class="hash-link" aria-label="Direct link to Code Examples" title="Direct link to Code Examples" translate="no">â€‹</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-1-multi-sensor-fusion-node">Example 1: Multi-Sensor Fusion Node<a href="#example-1-multi-sensor-fusion-node" class="hash-link" aria-label="Direct link to Example 1: Multi-Sensor Fusion Node" title="Direct link to Example 1: Multi-Sensor Fusion Node" translate="no">â€‹</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># code_examples/sensor_fusion_node.py</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> numpy </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> np</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> rclpy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> message_filters </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Subscriber</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ApproximateTimeSynchronizer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> geometry_msgs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">msg </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> PoseStamped</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sensor_msgs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">msg </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Imu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> nav_msgs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">msg </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Odometry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">MultiSensorFusion</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rclpy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Node</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">__init__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin">super</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">__init__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;multi_sensor_fusion&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Subscribers with synchronization</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        visual_sub </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Subscriber</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> PoseStamped</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/camera/odometry&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        lidar_sub </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Subscriber</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> PoseStamped</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/lidar/odometry&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        imu_sub </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Subscriber</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Imu</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/imu/data&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sync </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ApproximateTimeSynchronizer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">visual_sub</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> lidar_sub</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> imu_sub</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            queue_size</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> slop</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0.1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sync</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">registerCallback</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fusion_callback</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fused_pub </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">create_publisher</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Odometry</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/fused/odometry&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">fusion_callback</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> visual</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> lidar</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> imu</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;Fuse three sensor modalities&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Extract covariances</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        visual_cov </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.05</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># high confidence</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        lidar_cov </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.10</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic"># medium confidence</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        imu_cov </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.5</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># low confidence for position</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Weight by inverse covariance</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        weights </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">array</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">visual_cov</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">lidar_cov</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">imu_cov</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        weights </span><span class="token operator" style="color:#393A34">/=</span><span class="token plain"> weights</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">sum</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># normalize</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Weighted average of positions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        positions </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">array</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">visual</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pose</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">position</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> visual</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pose</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">position</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">y</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">lidar</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pose</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">position</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> lidar</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pose</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">position</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">y</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">imu</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">orientation</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> imu</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">orientation</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">y</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># IMU limited</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fused_position </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> weights</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">reshape</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> positions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fused_position </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> fused_position</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">sum</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">axis</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Publish fused estimate</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        odometry </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Odometry</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        odometry</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pose</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pose</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">position</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> fused_position</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        odometry</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pose</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pose</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">position</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">y </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> fused_position</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        odometry</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">header</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">stamp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get_clock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">now</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to_msg</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        odometry</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">header</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">frame_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;map&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fused_pub</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">publish</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">odometry</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-2-sensor-validation">Example 2: Sensor Validation<a href="#example-2-sensor-validation" class="hash-link" aria-label="Direct link to Example 2: Sensor Validation" title="Direct link to Example 2: Sensor Validation" translate="no">â€‹</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># code_examples/validate_sensor_fusion_accuracy.py</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> numpy </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> np</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">FusionValidator</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rclpy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Node</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">__init__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin">super</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">__init__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;fusion_validator&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">single_sensor_errors </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fused_errors </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">evaluate_accuracy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> single_sensor</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fused</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ground_truth</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        Measure improvement from fusion</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        single_error </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">linalg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">norm</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">single_sensor </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> ground_truth</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fused_error </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">linalg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">norm</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fused </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> ground_truth</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        improvement </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">single_error </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> fused_error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> single_error </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get_logger</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-interpolation string" style="color:#e3116c">f&#x27;Single sensor error: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">single_error</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">:</span><span class="token string-interpolation interpolation format-spec">.3f</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">m\n&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-interpolation string" style="color:#e3116c">f&#x27;Fused error: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">fused_error</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">:</span><span class="token string-interpolation interpolation format-spec">.3f</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">m\n&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-interpolation string" style="color:#e3116c">f&#x27;Improvement: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">improvement</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">:</span><span class="token string-interpolation interpolation format-spec">.1f</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">%&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> improvement</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="practice-exercise">Practice Exercise<a href="#practice-exercise" class="hash-link" aria-label="Direct link to Practice Exercise" title="Direct link to Practice Exercise" translate="no">â€‹</a></h2>
<p><strong>Objective</strong>: Implement multi-sensor fusion and verify &gt;20% accuracy improvement</p>
<p><strong>Steps</strong>:</p>
<ol>
<li class="">Set up three odometry sources:<!-- -->
<ul>
<li class="">Visual odometry (camera-based SLAM)</li>
<li class="">LiDAR odometry (if available, or use simulated)</li>
<li class="">IMU (gyroscope-based orientation)</li>
</ul>
</li>
<li class="">Implement temporal synchronization</li>
<li class="">Create fusion node with weighted averaging</li>
<li class="">Run test scenario in Gazebo:<!-- -->
<ul>
<li class="">Well-lit room (cameras work well)</li>
<li class="">Dark room (cameras fail, LiDAR works)</li>
<li class="">Feature-poor corridor (LiDAR ambiguous)</li>
</ul>
</li>
<li class="">Measure accuracy improvement</li>
</ol>
<p><strong>Success criteria</strong>:</p>
<ul>
<li class="">Fusion node runs without errors</li>
<li class="">Temporal synchronization working (topics synchronized)</li>
<li class="">
<blockquote>
<p>20% accuracy improvement over best single sensor</p>
</blockquote>
</li>
<li class="">Graceful failure handling (fallback when sensor dies)</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="references">References<a href="#references" class="hash-link" aria-label="Direct link to References" title="Direct link to References" translate="no">â€‹</a></h2>
<ul>
<li class=""><strong>Sensor Fusion Survey</strong>: <a href="https://arxiv.org/abs/1902.01305" target="_blank" rel="noopener noreferrer" class="">Multi-Sensor Fusion Review</a></li>
<li class=""><strong>Extended Kalman Filter</strong>: <a href="https://www.kalmanfilter.net/multivariate_k.html" target="_blank" rel="noopener noreferrer" class="">EKF Tutorial</a></li>
<li class=""><strong>ROS 2 message_filters</strong>: <a href="http://wiki.ros.org/message_filters" target="_blank" rel="noopener noreferrer" class="">Message Filters Documentation</a></li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="next-steps">Next Steps<a href="#next-steps" class="hash-link" aria-label="Direct link to Next Steps" title="Direct link to Next Steps" translate="no">â€‹</a></h2>
<p>You now understand multi-sensor fusion for robust perception. Choose your path:</p>
<ul>
<li class=""><strong>â†’ <a class="" href="/docs/Autonomous-Navigation/capstone-mission">Lesson 8: Capstone</a></strong> (Integrate complete system)</li>
</ul>
<hr>
<p><strong>Lesson 7 Summary</strong>: Multi-sensor fusion combines visual, range, and inertial information for &gt;20% accuracy improvement. Temporal synchronization, covariance weighting, and failure handling enable robust autonomous navigation in diverse conditions.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/your-org/ai-book/tree/main/docs/04-Autonomous-Navigation/07-multi-sensor-perception-and-fusion.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/Autonomous-Navigation/autonomous-humanoid-navigation"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Lesson 6: Autonomous Humanoid Navigation</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/Autonomous-Navigation/capstone-mission"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Lesson 8: Capstone - Autonomous Navigation End-to-End</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#learning-outcomes" class="table-of-contents__link toc-highlight">Learning Outcomes</a></li><li><a href="#layer-1-foundation" class="table-of-contents__link toc-highlight">Layer 1: Foundation</a><ul><li><a href="#71-sensor-characteristics" class="table-of-contents__link toc-highlight">7.1 Sensor Characteristics</a></li><li><a href="#72-sensor-fusion-motivation" class="table-of-contents__link toc-highlight">7.2 Sensor Fusion Motivation</a></li><li><a href="#73-fusion-architectures" class="table-of-contents__link toc-highlight">7.3 Fusion Architectures</a></li><li><a href="#74-covariance-weighted-fusion" class="table-of-contents__link toc-highlight">7.4 Covariance-Weighted Fusion</a></li></ul></li><li><a href="#layer-2-collaboration-ros-2-integration" class="table-of-contents__link toc-highlight">Layer 2: Collaboration (ROS 2 Integration)</a><ul><li><a href="#21-temporal-synchronization" class="table-of-contents__link toc-highlight">2.1 Temporal Synchronization</a></li><li><a href="#22-using-message_filters-for-synchronization" class="table-of-contents__link toc-highlight">2.2 Using message_filters for Synchronization</a></li><li><a href="#23-sensor-fusion-node-architecture" class="table-of-contents__link toc-highlight">2.3 Sensor Fusion Node Architecture</a></li></ul></li><li><a href="#layer-3-intelligence-fusion-tuning" class="table-of-contents__link toc-highlight">Layer 3: Intelligence (Fusion Tuning)</a><ul><li><a href="#31-covariance-tuning" class="table-of-contents__link toc-highlight">3.1 Covariance Tuning</a></li><li><a href="#32-failure-mode-handling" class="table-of-contents__link toc-highlight">3.2 Failure Mode Handling</a></li><li><a href="#33-measuring-fusion-performance" class="table-of-contents__link toc-highlight">3.3 Measuring Fusion Performance</a></li></ul></li><li><a href="#layer-4-advanced" class="table-of-contents__link toc-highlight">Layer 4: Advanced</a><ul><li><a href="#41-extended-kalman-filter-ekf-fusion" class="table-of-contents__link toc-highlight">4.1 Extended Kalman Filter (EKF) Fusion</a></li></ul></li><li><a href="#summary" class="table-of-contents__link toc-highlight">Summary</a></li><li><a href="#code-examples" class="table-of-contents__link toc-highlight">Code Examples</a><ul><li><a href="#example-1-multi-sensor-fusion-node" class="table-of-contents__link toc-highlight">Example 1: Multi-Sensor Fusion Node</a></li><li><a href="#example-2-sensor-validation" class="table-of-contents__link toc-highlight">Example 2: Sensor Validation</a></li></ul></li><li><a href="#practice-exercise" class="table-of-contents__link toc-highlight">Practice Exercise</a></li><li><a href="#references" class="table-of-contents__link toc-highlight">References</a></li><li><a href="#next-steps" class="table-of-contents__link toc-highlight">Next Steps</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Content</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/01-Welcome/01-introduction">Book</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/your-org/ai-book" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2025 AI-Native Book. Built with Docusaurus.</div></div></div></footer><button class="chat-widget-button"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg></button></div>
</body>
</html>